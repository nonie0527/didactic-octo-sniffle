<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å®šä½è³‡è¨Šé€å‡º</title>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    #status { margin-top: 1em; color: green; }
    input { margin: 0.5em 0; padding: 0.5em; width: 100%; max-width: 300px; }
    button { padding: 0.5em 1em; }
    .qr-section { margin-top: 2em; }
    img.qr { width: 300px; }
  </style>
</head>
<body>
  <h2>å®šä½è³‡è¨Šé€å‡ºæ¸¬è©¦</h2>
  <p>è«‹è¼¸å…¥æ‚¨çš„ Email ä¸¦å…è¨±å®šä½æ¬Šé™ï¼Œç³»çµ±å°‡è‡ªå‹•é€å‡ºå®šä½è³‡è¨Šã€‚</p>
  <input type="email" id="email" placeholder="è«‹è¼¸å…¥æ‚¨çš„ Email" required>
  <button onclick="submitLocation()">é€å‡ºå®šä½è³‡è¨Š</button>
  <div id="status">å°šæœªé€å‡º</div>

  <div class="qr-section">
    <h3>ğŸ“± æƒæ QR Code é–‹å•Ÿæœ¬é é¢</h3>
    <img class="qr" src="https://kr-prod.asyncgw.teams.microsoft.com/v1/objects/0-ea-d12-80a935a7ca976ddd31e38b28b1e0a437/views/original/generated_image.png" alt="å®šä½è³‡è¨Š QR Code">
  </div>

  <script>
    const statusDiv = document.getElementById("status");
    const webAppUrl = "https://script.google.com/macros/s/AKfycbyjR6EL9ZRx3v3i-FYXeHxoAjRQU-1HNnwPnPQTChOcBbf0xLaC1DysTOp3iZKedeES2g/exec";

    function submitLocation() {
      const email = document.getElementById("email").value.trim();
      if (!email) {
        statusDiv.textContent = "è«‹å…ˆè¼¸å…¥ Emailã€‚";
        return;
      }

      if (navigator.geolocation) {
        statusDiv.textContent = "æ­£åœ¨å–å¾—å®šä½è³‡è¨Š...";
        navigator.geolocation.getCurrentPosition(
          position => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            statusDiv.textContent = `å–å¾—åº§æ¨™ï¼š(${lat}, ${lng})ï¼ŒEmailï¼š${email}ï¼Œæ­£åœ¨é€å‡º...`;

            fetch(webAppUrl, {
              method: "POST",
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              body: new URLSearchParams({ lat: lat, lng: lng, email: email })
            })
            .then(response => response.text())
            .then(data => {
              statusDiv.textContent = `ä¼ºæœå™¨å›æ‡‰ï¼š${data}`;
            })
            .catch(error => {
              statusDiv.textContent = `é€å‡ºå¤±æ•—ï¼š${error}`;
            });
          },
          error => {
            statusDiv.textContent = "ç„¡æ³•å–å¾—å®šä½ï¼š" + error.message;
          }
        );
      } else {
        statusDiv.textContent = "æ‚¨çš„è£ç½®ä¸æ”¯æ´å®šä½åŠŸèƒ½ã€‚";
      }
    }
  </script>
</body>
</html>
