<!DOCTYPE html>

<html lang="zh-Hant">
<head><meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<title>å®šä½è³‡è¨Šé€å‡º</title>
<style>
    .page-body { font-family: sans-serif; padding: 2em; }
    .status-output { margin-top: 1em; color: green; }
    .input-field { margin: 0.5em 0; padding: 0.5em; width: 100%; max-width: 300px; }
    .submit-button { padding: 0.5em 1em; }
    .input-error { border: 2px solid red; }
    </style>
</head>
<body class="page-body">
<p>æˆ‘å€‘å°‡ä½¿ç”¨æ‚¨çš„å®šä½è³‡è¨Šä¾†è¨˜éŒ„æ‚¨æ‰€åœ¨çš„ä½ç½®ï¼Œè³‡æ–™å°‡é€è‡³ Google è©¦ç®—è¡¨ä½œç‚ºç´€éŒ„ç”¨é€”ã€‚</p><h2>å®šä½è³‡è¨Šé€å‡ºæ¸¬è©¦</h2>
<p>è«‹è¼¸å…¥æ‚¨çš„ Email ä¸¦å…è¨±å®šä½æ¬Šé™ï¼Œç³»çµ±å°‡è‡ªå‹•é€å‡ºå®šä½è³‡è¨Šã€‚</p>
<input class="input-field" id="email" placeholder="è«‹è¼¸å…¥æ‚¨çš„ Email" required="required" type="email"/>
<button class="submit-button" id="submitBtn" onclick="submitLocation()">é€å‡ºå®šä½è³‡è¨Š</button>
<output aria-live="polite" class="status-output" id="status">å°šæœªé€å‡º</output>
<script>
    const statusDiv = document.getElementById("status");
    const spinner = document.getElementById("spinner");
    const emailInput = document.getElementById("email");
    const submitBtn = document.getElementById("submitBtn");
    const webAppUrl = "https://script.google.com/macros/s/AKfycbyjR6EL9ZRx3v3i-FYXeHxoAjRQU-1HNnwPnPQTChOcBbf0xLaC1DysTOp3iZKedeES2g/exec";

    function validateEmail(email) {
      return /\S+@\S+\.\S+/.test(email);
    }

    function submitLocation() {
      const email = emailInput.value.trim();
      emailInput.classList.remove("input-error");
      if (!email) {
        statusDiv.textContent = "è«‹å…ˆè¼¸å…¥ Emailã€‚";
        emailInput.classList.add("input-error");
        return;
      }
      if (!validateEmail(email)) {
        statusDiv.textContent = "è«‹è¼¸å…¥æœ‰æ•ˆçš„ Email åœ°å€ã€‚";
        emailInput.classList.add("input-error");
        return;
      }

      if (navigator.geolocation) {
        statusDiv.textContent = "æ­£åœ¨å–å¾—å®šä½è³‡è¨Š...";
        spinner.style.display = "block";
        navigator.geolocation.getCurrentPosition(
          position => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            statusDiv.textContent = `å–å¾—åº§æ¨™ï¼š(${lat}, ${lng})ï¼ŒEmailï¼š${email}ï¼Œæ­£åœ¨é€å‡º...`;

            fetch(webAppUrl, {
              method: "POST",
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              body: new URLSearchParams({ lat: lat, lng: lng, email: email })
            })
            .then(response => {
              spinner.style.display = "none";
              if (!response.ok) {
                throw new Error(`ä¼ºæœå™¨éŒ¯èª¤ (${response.status})`);
              }
              return response.text();
            })
            .then(data => {
              statusDiv.textContent = `ä¼ºæœå™¨å›æ‡‰ï¼š${data}`;
            })
            .catch(error => {
              statusDiv.textContent = `é€å‡ºå¤±æ•—ï¼š${error}`;
            });
          },
          error => {
            spinner.style.display = "none";
            switch (error.code) {
              case error.PERMISSION_DENIED:
                statusDiv.textContent = "ä½¿ç”¨è€…æ‹’çµ•æä¾›å®šä½æ¬Šé™ã€‚";
                break;
              case error.POSITION_UNAVAILABLE:
                statusDiv.textContent = "ç„¡æ³•å–å¾—å®šä½è³‡è¨Šã€‚";
                break;
              case error.TIMEOUT:
                statusDiv.textContent = "å–å¾—å®šä½é€¾æ™‚ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚";
                break;
              default:
                statusDiv.textContent = "ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ï¼š" + error.message;
            }
          }
        );
      } else {
        statusDiv.textContent = "æ‚¨çš„è£ç½®ä¸æ”¯æ´å®šä½åŠŸèƒ½ã€‚";
      }
    }

    // Enable Enter key to trigger submit
    emailInput.addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        submitLocation();
      }
    });
    submitBtn.addEventListener("click", submitLocation);
    </script>
<div id="spinner" style="display:none;">ğŸ”„ è«‹ç¨å€™...</div></body>
</html>
